{% extends "base.html" %}
{% block content %}

<style>
body{
    background:linear-gradient(135deg,#020617,#0f172a);
}

/* ========== WRAPPER ========== */
.order-detail-wrapper{
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:40px 10px;
}
.order-detail-card{
    width:100%;
    max-width:1000px;
    background:rgba(255,255,255,0.08);
    backdrop-filter:blur(18px);
    border-radius:24px;
    border:1px solid rgba(255,255,255,0.15);
    box-shadow:0 30px 80px rgba(0,0,0,.4);
    padding:28px;
    animation:fadeInUp .7s ease;
}
@keyframes fadeInUp{
    from{opacity:0;transform:translateY(40px)}
    to{opacity:1;transform:translateY(0)}
}

/* ========== HEADER ========== */
.order-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    flex-wrap:wrap;
    gap:10px;
    margin-bottom:20px;
}
.order-title{
    font-size:28px;
    font-weight:900;
    color:#ecfeff;
}
.order-date{
    color:#cbd5f5;
    font-weight:700;
    font-size:14px;
}

/* ========== TABLE ========== */
.order-table{
    width:100%;
    border-collapse:separate;
    border-spacing:0 12px;
}
.order-table thead th{
    text-align:left;
    padding:12px 16px;
    color:#a7f3d0;
    font-weight:900;
    font-size:14px;
    letter-spacing:.5px;
}
.order-table tbody tr{
    background:rgba(255,255,255,0.08);
    border-radius:16px;
    transition:.3s ease;
}
.order-table tbody tr:hover{
    background:rgba(34,197,94,0.15);
    transform:translateX(4px) scale(1.01);
}
.order-table td{
    padding:16px;
    color:#f8fafc;
    font-weight:700;
}
.order-table td:first-child{
    border-radius:16px 0 0 16px;
}
.order-table td:last-child{
    border-radius:0 16px 16px 0;
}

/* ========== CELLS ========== */
.product-name{
    font-weight:900;
    color:#f8fafc;
}
.qty-badge{
    padding:4px 12px;
    border-radius:999px;
    background:#6366f1;
    color:#eef2ff;
    font-weight:900;
    font-size:13px;
}
.price{
    color:#a7f3d0;
    font-weight:900;
}
.subtotal{
    color:#4ade80;
    font-weight:900;
}

/* ========== TOTAL ========== */
.order-total-box{
    margin-top:20px;
    padding:16px 20px;
    border-radius:18px;
    background:linear-gradient(135deg,#22c55e,#4ade80);
    color:#022c22;
    display:flex;
    justify-content:space-between;
    align-items:center;
    font-size:20px;
    font-weight:900;
}

/* ========== EMPTY ========== */
.empty-box{
    text-align:center;
    padding:60px 20px;
    color:#e5e7eb;
}
.empty-box h3{
    font-size:26px;
    font-weight:900;
    margin-bottom:10px;
}
.empty-box p{
    color:#94a3b8;
}

/* ========== BACK BUTTON ========== */
.back-btn{
    margin-top:24px;
    display:inline-block;
    padding:10px 22px;
    border-radius:999px;
    font-weight:900;
    font-size:14px;
    text-decoration:none;
    background:rgba(255,255,255,0.1);
    color:#ecfeff;
    border:1px solid rgba(255,255,255,0.2);
    transition:.3s ease;
}
.back-btn:hover{
    background:#22c55e;
    color:#022c22;
    box-shadow:0 0 20px rgba(34,197,94,.6);
    transform:translateX(-4px);
}
</style>

<div class="order-detail-wrapper">
    <div class="order-detail-card">

        <!-- HEADER -->
        <div class="order-header">
            <div class="order-title">ðŸ§¾ Order #{{ order.id }}</div>
            <div class="order-date">ðŸ“… {{ order.created_at|date:"D, d M Y H:i" }}</div>
        </div>

        {% if order.items.exists %}
        <div class="table-responsive">
            <table class="order-table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Qty</th>
                        <th>Price</th>
                        <th>Subtotal</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in order.items.all %}
                    <tr>
                        <td class="product-name">{{ item.product.name }}</td>
                        <td><span class="qty-badge">Ã—{{ item.quantity }}</span></td>
                        {% with unit=item.price|default_if_none:item.product.price %}
                          {% widthratio item.quantity 1 unit as line_total %}
                          <td class="price">$ {{ unit|default:"0"|floatformat:2 }}</td>
                          <td class="subtotal">$ {{ line_total|floatformat:2 }}</td>
                        {% endwith %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="order-total-box">
          <span>Total</span>
          <span>$ {{ order.total_amount|default:"0"|floatformat:2 }}</span>
        </div>

        <script>
        (function(){
          // Fallback: if total_amount is 0, sum subtotals from DOM
          const totalEl = document.querySelector('.order-total-box span:last-child');
          const subs = document.querySelectorAll('.order-table .subtotal');
          if (!totalEl || subs.length === 0) return;
          const current = parseFloat(totalEl.textContent.replace(/[^0-9.\-]/g,'')) || 0;
          if (current > 0) return;
          let sum = 0;
          subs.forEach(s => {
            const v = parseFloat(s.textContent.replace(/[^0-9.\-]/g,'')) || 0;
            sum += v;
          });
          if (sum > 0) totalEl.textContent = `$ ${sum.toFixed(2)}`;
        })();
        </script>

        {% else %}
        <div class="empty-box">
            <h3>ðŸ˜• No Items Found</h3>
            <p>This order does not contain any products.</p>
        </div>
        {% endif %}

        <a href="{% url 'shop:orders_list' %}" class="back-btn">
            â¬… Back to Orders
        </a>

    </div>
</div>

{% endblock %}
