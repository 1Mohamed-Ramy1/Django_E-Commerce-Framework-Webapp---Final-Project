<!-- NAVBAR - Sticky, Intelligent, Premium -->
<nav class="navbar" role="navigation" aria-label="Main navigation">
    <div class="navbar-container">
        <!-- Logo & Brand -->
        <div class="navbar-brand">
            <a href="{% url 'shop:shop_home' %}" class="logo">
                <span class="logo-icon">ğŸ›ï¸</span>
                <span class="logo-text">ELOSTORA</span>
            </a>
        </div>

        <!-- Center Clock -->
        <div class="navbar-clock" id="navbar-clock">{{ now|date:"D, d M Y h:i A" }}</div>

        <!-- Desktop Navigation Menu -->
        <div class="navbar-menu hide-on-mobile">
            <a href="{% url 'shop:category_list' %}" class="nav-link">ğŸ“‚ category</a>
            <a href="{% url 'gift:gift_list' %}" class="nav-link">ğŸ Gifts</a>
            <a href="{% url 'blog:public_list' %}" class="nav-link">ğŸ“ Blog</a>
            <a href="{% url 'events:event_list' %}" class="nav-link">ğŸ“… Events</a>
        </div>

        <!-- Right Section: Search, Cart, User -->
        <div class="navbar-actions">
            <!-- Search Bar -->
            <div class="search-wrapper">
                <form method="GET" action="{% url 'shop:global_search' %}" class="search-form" role="search">
                    <input type="text" name="q" placeholder="Search products..." class="search-input" autocomplete="off" aria-autocomplete="list" aria-controls="nav-search-suggestions">
                    <button type="submit" class="search-btn" aria-label="Search">ğŸ”</button>
                </form>
                <div class="search-suggestions" id="nav-search-suggestions" role="listbox" aria-label="Search suggestions" hidden></div>
            </div>

            <!-- Cart Icon -->
            {% if request.user.is_authenticated %}
            <a href="{% url 'shop:view_cart' %}" class="nav-icon cart-icon" aria-label="Shopping cart">
                ğŸ›’
                {% if cart_count > 0 %}
                <span class="badge">{{ cart_count }}</span>
                {% endif %}
            </a>
            {% endif %}

            <!-- User Profile Menu -->
            <div class="user-menu">
                {% if request.user.is_authenticated %}
                    <button class="user-btn" aria-label="User menu" aria-expanded="false">
                        ğŸ‘¤ {{ request.user.username }}
                    </button>
                    <div class="user-dropdown">
                        <a href="{% url 'accounts:profile' %}" class="dropdown-item">
                            <span>ğŸ‘¤</span> Profile
                        </a>
                        <a href="{% url 'shop:orders_list' %}" class="dropdown-item">
                            <span>ğŸ“¦</span> Orders History
                        </a>
                        {% if request.user.is_staff %}
                        <a href="{% url 'dashboard:home' %}" class="dropdown-item">
                            <span>ğŸ›¡ï¸</span> Admin Panel
                        </a>
                        {% endif %}
                        <hr class="dropdown-divider">
                        <a href="{% url 'accounts:logout' %}" class="dropdown-item logout">
                            <span>ğŸšª</span> Logout
                        </a>
                    </div>
                {% else %}
                    <a href="{% url 'accounts:login' %}" class="btn btn-primary btn-sm">Login</a>
                    <a href="{% url 'accounts:register' %}" class="btn btn-secondary btn-sm hide-on-mobile">Register</a>
                {% endif %}
            </div>

            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-btn show-on-mobile" aria-label="Toggle menu" aria-expanded="false">
                â˜°
            </button>
        </div>
    </div>
</nav>

<style>
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
/* ğŸ§­ PREMIUM NAVBAR - Sticky & Intelligent */
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

.navbar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    z-index: 10000;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.navbar-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    max-width: 1400px;
    margin: 0 auto;
    padding: 14px 24px;
    gap: 28px;
    width: 100%;
    position: relative;
}

.navbar-clock {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    color: #1a1a2e;
    font-weight: 800;
    letter-spacing: 0.02em;
    font-size: 18px;
}

/* Logo & Brand */
.navbar-brand {
    flex-shrink: 0;
}

.logo {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 20px;
    font-weight: 900;
    color: #1a1a2e;
    transition: color 0.15s;
    text-decoration: none;
}

.logo:hover {
    color: #667eea;
}

.logo-icon {
    font-size: 28px;
}

.logo-text {
    letter-spacing: 0.1em;
}

/* Desktop Navigation */
.navbar-menu {
    display: flex;
    gap: 32px;
    flex: 1;
    margin-left: 64px;
    justify-content: flex-start;
}

.nav-link {
    color: #424242;
    font-weight: 500;
    position: relative;
    transition: color 0.15s;
    text-decoration: none;
    font-size: 15px;
    white-space: nowrap;
}

.nav-link::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 0;
    height: 2px;
    background: #667eea;
    transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.nav-link:hover {
    color: #667eea;
}

.nav-link:hover::after {
    width: 100%;
}

/* Right Actions */
.navbar-actions {
    display: flex;
    align-items: center;
    gap: 18px; /* Ù…Ø³Ø§ÙØ© Ù…ÙˆØ­Ø¯Ø© ÙˆÙ†Ø§Ø¹Ù…Ø© */
    flex-shrink: 0;
}

.nav-icon,
.user-btn,
.mobile-menu-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 40px;
    height: 40px;
    border-radius: 10px;
}

/* Search Bar */
.search-wrapper {
    position: relative;
    width: 300px;
    margin-right: 6px;
}

.search-form {
    display: flex;
    align-items: center;
    background: #f0f2f5;
    border-radius: 9999px;
    border: 2px solid transparent;
    transition: all 0.15s;
}

.search-form:focus-within {
    border-color: #667eea;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
}

.search-input {
    flex: 1;
    background: transparent;
    border: none;
    padding: 8px 16px;
    font-size: 14px;
    outline: none;
    font-family: inherit;
}

.search-input::placeholder {
    color: #9e9e9e;
}

.search-btn {
    padding: 8px 16px;
    background: transparent;
    color: #757575;
    font-size: 16px;
    transition: color 0.15s;
    cursor: pointer;
    border: none;
}

.search-btn:hover {
    color: #667eea;
}

/* Suggestions Dropdown */
.search-suggestions {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    right: 0;
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 16px 32px rgba(0, 0, 0, 0.12);
    border: 1px solid #e8e8e8;
    overflow: hidden;
    z-index: 10002;
    max-height: 320px;
    overflow-y: auto;
}

.suggestion-item {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 12px;
    align-items: center;
    padding: 10px 14px;
    color: #424242;
    text-decoration: none;
    transition: background 0.15s, color 0.15s;
}

.suggestion-item:hover,
.suggestion-item.active {
    background: #f6f7fb;
    color: #1a1a2e;
}

.suggestion-type {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    padding: 4px 8px;
    border-radius: 9999px;
    background: #f0f2f5;
    color: #667eea;
}

.suggestion-type.product { color: #667eea; background: rgba(102,126,234,0.12); }
.suggestion-type.category { color: #764ba2; background: rgba(118,75,162,0.12); }
.suggestion-type.subcategory { color: #f093fb; background: rgba(240,147,251,0.12); }

.suggestion-label {
    font-size: 14px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Cart Icon */
.cart-icon {
    position: relative;
    font-size: 20px;
    padding: 8px;
    border-radius: 10px;
    transition: transform 0.15s, background 0.15s;
}

.cart-icon:hover {
    transform: scale(1.08);
    background: #f0f2f5;
}


.cart-icon .badge {
    position: absolute;
    top: -8px;
    right: -8px;
    background: #e53935;
    color: white;
    font-size: 11px;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 9999px;
}

/* User Menu */
.user-menu {
    position: relative;
}

.user-btn {
    padding: 8px 14px;
    gap: 8px;
    background: transparent;
    color: #424242;
    font-weight: 500;
    transition: all 0.15s;
    cursor: pointer;
    border: none;
    font-family: inherit;
}

.user-btn:hover {
    color: #667eea;
}

.user-dropdown {
    position: absolute;
    top: calc(100% + 8px);
    right: 0;
    background: white;
    border-radius: 12px;
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
    min-width: 200px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 10001;
}

.user-menu:hover .user-dropdown {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.dropdown-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 20px;
    color: #424242;
    font-size: 14px;
    transition: all 0.15s;
    text-decoration: none;
}

.dropdown-item:first-child {
    border-radius: 12px 12px 0 0;
}

.dropdown-item:hover {
    background: #f0f2f5;
    color: #667eea;
    padding-left: 24px;
}

.dropdown-item.logout {
    color: #e53935;
}

.dropdown-item.logout:hover {
    background: rgba(229, 57, 53, 0.1);
}

.dropdown-divider {
    height: 1px;
    border: none;
    background: #e0e0e0;
    margin: 0;
}

/* Mobile Menu Toggle */
.mobile-menu-btn {
    font-size: 24px;
    background: transparent;
    color: #424242;
    cursor: pointer;
    transition: color 0.15s;
    border: none;
}

.mobile-menu-btn:hover {
    color: #667eea;
}

/* Unified icon sizing for visual balance */
.nav-icon,
.user-btn,
.mobile-menu-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 40px;
    height: 40px;
    border-radius: 10px;
}

/* Buttons in navbar */
.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 8px 16px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 8px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    text-decoration: none;
    white-space: nowrap;
    user-select: none;
    position: relative;
    overflow: hidden;
    border: none;
    cursor: pointer;
    font-family: inherit;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 30px rgba(102, 126, 234, 0.5);
}

.btn-secondary {
    background: #f0f2f5;
    color: #667eea;
    border: 2px solid #667eea;
}

.btn-secondary:hover {
    background: #667eea;
    color: white;
    transform: translateY(-2px);
}

.btn-sm {
    padding: 6px 12px;
    font-size: 12px;
}

/* Responsive */
@media (max-width: 768px) {
    .navbar-container {
        padding: 12px;
    }
    
    .search-wrapper {
        width: 150px;
    }
    
    .search-input {
        padding: 6px 10px;
        font-size: 12px;
    }
}

@media (max-width: 640px) {
    .navbar-actions {
        gap: 10px;
    }
    
    .search-wrapper {
        max-width: 120px;
    }
}

.hide-on-mobile {
    display: none;
}

.show-on-mobile {
    display: block;
}

@media (min-width: 768px) {
    .hide-on-mobile {
        display: block;
    }
    
    .show-on-mobile {
        display: none;
    }
}
</style>

<script>
(function() {
    const wrapper = document.currentScript && document.currentScript.previousElementSibling ? document.currentScript.previousElementSibling : null;
    const root = document.querySelector('.navbar');
    const form = root && root.querySelector('.search-form');
    if (!form) return;
    const input = form.querySelector('.search-input');
    const panel = root.querySelector('#nav-search-suggestions');
    const endpoint = "{% url 'shop:suggestions_api' %}";

    let controller = null;
    let activeIndex = -1;
    let items = [];
    const limit = 8;

    const debounce = (fn, delay=200) => {
        let t; return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), delay); };
    };

    function render(list) {
        items = list || [];
        activeIndex = -1;
        if (!items.length) {
            panel.innerHTML = '';
            panel.hidden = true;
            return;
        }
        panel.innerHTML = items.map((it, i) => `
            <a href="${it.url}" class="suggestion-item" role="option" data-index="${i}">
                <span class="suggestion-type ${it.type}">${it.type}</span>
                <span class="suggestion-label">${it.label.replace(/</g,'&lt;')}</span>
            </a>
        `).join('');
        panel.hidden = false;
    }

    async function fetchSuggestions(q) {
        if (controller) controller.abort();
        controller = new AbortController();
        try {
            const url = `${endpoint}?q=${encodeURIComponent(q)}&limit=${limit}`;
            const res = await fetch(url, { signal: controller.signal });
            if (!res.ok) throw new Error('network');
            const data = await res.json();
            render((data && (data.suggestions || data.results)) || []);
        } catch (e) {
            // swallow
        }
    }

    const onInput = debounce((ev) => {
        const q = (input.value || '').trim();
        if (q.length < 2) { render([]); return; }
        fetchSuggestions(q);
    }, 180);

    input.addEventListener('input', onInput);
    input.addEventListener('focus', () => {
        const q = (input.value || '').trim();
        if (q.length >= 2) fetchSuggestions(q);
    });

    document.addEventListener('click', (e) => {
        if (!panel.contains(e.target) && !form.contains(e.target)) {
            panel.hidden = true;
        }
    });

    panel.addEventListener('mouseover', (e) => {
        const a = e.target.closest('.suggestion-item');
        if (!a) return;
        const idx = parseInt(a.getAttribute('data-index'), 10);
        setActive(idx);
    });

    function setActive(idx) {
        activeIndex = idx;
        [...panel.querySelectorAll('.suggestion-item')].forEach((el, i) => {
            if (i === activeIndex) el.classList.add('active'); else el.classList.remove('active');
        });
    }

    input.addEventListener('keydown', (e) => {
        if (panel.hidden || !items.length) return;
        const max = items.length - 1;
        if (e.key === 'ArrowDown') { e.preventDefault(); setActive(Math.min(max, activeIndex + 1)); }
        else if (e.key === 'ArrowUp') { e.preventDefault(); setActive(Math.max(0, activeIndex - 1)); }
        else if (e.key === 'Enter') {
            if (activeIndex >= 0 && items[activeIndex]) {
                e.preventDefault();
                window.location.href = items[activeIndex].url;
            }
        } else if (e.key === 'Escape') {
            panel.hidden = true;
        }
    });
})();
// Live clock for navbar
(function(){
    const el = document.getElementById('navbar-clock');
    if(!el) return;
    const days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
    const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    const pad = (n) => String(n).padStart(2, '0');
    function fmt(d){
        let h = d.getHours();
        const ampm = h >= 12 ? 'PM' : 'AM';
        h = h % 12; if (h === 0) h = 12;
        return `${days[d.getDay()]}, ${pad(d.getDate())} ${months[d.getMonth()]} ${d.getFullYear()} ${pad(h)}:${pad(d.getMinutes())} ${ampm}`;
    }
    function tick(){ el.textContent = fmt(new Date()); }
    tick();
    setInterval(tick, 1000);
})();
</script>
